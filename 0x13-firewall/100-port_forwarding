#!/usr/bin/env bash
# Script configures configure server so that its firewall redirects port 8080/TCP to port 80/TCP

# Check if the script is being run with root privileges
if [[ $EUID -ne 0 ]]; then
    echo "This script must be run with root privileges (sudo)."
    exit 1
fi

# Check if iptables is installed
if ! command -v iptables &>/dev/null; then
    echo "iptables is not installed. Please install it before running this script."
    sudo apt update
    sudo apt install iptables
fi

# Clear existing rules
iptables -F

# Enable port forwarding
echo "1" > /proc/sys/net/ipv4/ip_forward

# Redirect traffic from port 8080 to port 80
iptables -t nat -A PREROUTING -p tcp --dport 8080 -j REDIRECT --to-port 80

# Save the rules to persist across reboots
iptables-save > /etc/iptables/rules.v4

echo "Port 8080/TCP is now redirected to port 80/TCP using iptables."

# Display the current iptables rules
iptables -L -n
